<!DOCTYPE html>
<html>
    <head>
        <title>taskEditor test</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="../lib/jplayer/skin/blue.monday/css/jplayer.blue.monday.min.css" rel="stylesheet" type="text/css" />
        <link href="../lib/jquery-ui/jquery-ui.min.css" rel="stylesheet" type="text/css" />
        <link href="../css/task2.css" rel="stylesheet" type="text/css" />
        <link href="../css/task2edit.css" rel="stylesheet" type="text/css" />

        <script type="application/javascript" src="../lib/jquery-2.1.4.min.js"></script>
        <script type="application/javascript" src="../lib/jquery-ui/jquery-ui.min.js"></script>
        <script type="application/javascript" src="../lib/markup.min.js"></script>
        <script type="application/javascript" src="../lib/swfobject.js"></script>
        <script type="text/javascript"        src="../lib/recorder.js"></script>
        <script type="application/javascript" src="../js/voiceinputRecorder.js"></script>
        <script type="application/javascript" src="../js/voiceinputRecorderWorker.js"></script>
        <script type="application/javascript" src="../lib/jplayer/jplayer/jquery.jplayer.min.js"></script>
        <script type="application/javascript" src="../js/task2.js"></script>
        <script type="application/javascript" src="../js/task2edit.js"></script>
    </head>
    <body>

        <div style="width:800px;"><span style="display:inline-block;width:100%;">
                <div  style="float:right;margin-top:20px;">
                    Create:
                    <select id="snippet">
                        <option value=""></option>
                        <option value="../snippet/000.json">Empty task</option>
                        <option value="../snippet/001.json">1</option>
                        <option value="../snippet/002.json">2</option>
                        <option value="../snippet/002a.json">2a</option>
                        <option value="../snippet/002b.json">2б</option>
                        <option value="../snippet/002v.json">2в</option>
                        <!-- <option value="../snippet/003.json">3</option> -->
                        <option value="../snippet/004.json">4</option>
                        
                        <option value="../snippet/007.json">7</option>
                        <option value="../snippet/008.json">8</option>
                    </select>
                </div>
                <h3>Editor</h3>
            </span></div>
        <div id="taskEditor" class='taskEditor' style="width:800px;"></div>
        <div>
            <input type="button" id="previewButton" value="preview">
            <a id="download">Download</a>
        </div>
        
        <h3>Preview</h3>
        <div id="taskContainer" class='taskContainer'></div>


        <script type="application/javascript">
        $(document).ready(function(){
            try{
                entutor.html5audioapi.initAudioApi({
                    workerPath:'../js/voiceinputRecorderWorker.js',
                    soundScrorerURL:"./voiceinputscorer.php",
                    salt : 'kdsjlkajdo695bh'
                });
                entutor.inputs.recorder=entutor.html5recorder;
                // console.log("entutor.html5recorder");
            }catch(ex){
                // ------------------ flash recorder - begin -------------------
                entutor.recorderApp.initFlashRecorder({
                    swfPath : "../../task/lib/jplayer/jplayer",
                    swf : "../../task/lib/recorder.swf",
                    receiver : '../../demo/voiceinput2/upload.php',
                    iconRecord : '../../task/img/record.png',
                    iconStop : '../../task/img/stop.png',
                    iconUpload : '../../task/img/upload.png',
                    salt : 'kdsjlkajdo695bh'
                });
                entutor.inputs.recorder=entutor.flashrecorder;
                // console.log("entutor.flashrecorder");
                // ------------------ flash recorder - end ---------------------
            }

            //if(window.location.hash){
            //    entutor.loadEditor('json/'+window.location.hash.replace(/^#/,'')+'.json','#taskEditor');
            //}
            
            $(document).on("editor:updated",function(){
                if(entutor.currentEditor){
                    console.log(entutor.currentEditor.getValue());
                    var a=document.getElementById('download');
                    var json = JSON.stringify(entutor.currentEditor.getValue(), false,' '),
                        blob = new Blob([json], {type: "octet/stream"}),
                        url = window.URL.createObjectURL(blob);
                    a.href = url;
                    a.download = "undefined.json";
                }
            });
            
            $('#previewButton').click(function(){
                entutor.json=entutor.currentEditor.getValue();
                var task = new entutor.task(entutor.json);
                $("#taskContainer").empty().append(task.draw());
                task.start();
            });
            
            $('#snippet').change(function(){ 
                var s=$('#snippet').val();
                if(s.length>0){
                    entutor.loadEditor(s,'#taskEditor');
                    var a=document.getElementById('download');
                    a.href = "javascript:void('download')";
                }
                $('#snippet').val('');
            });
            
        });
            
        </script>
    </body>
</html>
